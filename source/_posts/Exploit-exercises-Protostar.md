---
title: Exploit-exercises_Protostar
categories: [PWN]
tags: [pwn, exploit-exercises]
---

Wargame from [Exploit-Exercises](https://exploit-exercises.com/protostar/).

---

## Stack 0

源码：

```c
#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>

int main(int argc, char **argv)
{
  volatile int modified;
  char buffer[64];

  modified = 0;
  gets(buffer);

  if(modified != 0) {
      printf("you have changed the 'modified' variable\n");
  } else {
      printf("Try again?\n");
  }
}
```

所以只需覆盖`modified`变量即可：

![Stack 0](Exploit-exercises-Protostar/stack0_0.png)

---

## Stack 1

源码：

``` c
#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>

int main(int argc, char **argv)
{
  volatile int modified;
  char buffer[64];

  if(argc == 1) {
      errx(1, "please specify an argument\n");
  }

  modified = 0;
  strcpy(buffer, argv[1]);

  if(modified == 0x61626364) {
      printf("you have correctly got the variable to the right value\n");
  } else {
      printf("Try again, you got 0x%08x\n", modified);
  }
}
```

此处要修改变量`modified`的值为`0x61626364`，需要注意是是`little endian`的问题——在低地址处存储低位字节，因此`0x64`（也就是`d`）应该在`modified`的第一个字节处。

![Stack 1](Exploit-exercises-Protostar/stack1_0.png)

---

## Stack 2

源码：

``` c
#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>

int main(int argc, char **argv)
{
  volatile int modified;
  char buffer[64];
  char *variable;

  variable = getenv("GREENIE");

  if(variable == NULL) {
      errx(1, "please set the GREENIE environment variable\n");
  }

  modified = 0;

  strcpy(buffer, variable);

  if(modified == 0x0d0a0d0a) {
      printf("you have correctly modified the variable\n");
  } else {
      printf("Try again, you got 0x%08x\n", modified);
  }

}
```

同上一题，只不过是需要使用`export`命令设置环境变量。

![Stack 2](Exploit-exercises-Protostar/stack2_0.png)

---

## Stack 3

题目源码：

``` c
#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>

void win()
{
  printf("code flow successfully changed\n");
}

int main(int argc, char **argv)
{
  volatile int (*fp)();
  char buffer[64];

  fp = 0;

  gets(buffer);

  if(fp) {
      printf("calling function pointer, jumping to 0x%08x\n", fp);
      fp();
  }
}
```

首先要知道`win()`函数的地址，使用`objdump`命令可以查看函数地址：

![objdump查看函数地址](Exploit-exercises-Protostar/stack3_0.png)

可以看到`win()`函数的地址为`0x08048490`，所以：

![Stack 3](Exploit-exercises-Protostar/stack3_1.png)

---

## Stack 4

